<link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
<script>
  const map = new maplibregl.Map({
    container:'map',
    ...({{ site.data.map.config | jsonify }}),
  });

  // add your data as sources + layers you control
  map.on('load', async () => {
    {% for kv in site.data.map.layers -%}
    {%- assign k = kv[0] -%}
    {%- assign layer = kv[1] -%}
    map.addSource('{{ k }}', { type:'geojson', data: '/map/layers/{{ layer.file }}.geo.json' });
    map.addLayer({ id:'{{ k }}-{{ layer.type }}', type:'{{ layer.type }}', source:'{{ k }}',
      paint: {{ layer.paint | jsonify }} });
    {%- endfor %}
  });

  map.addControl(new maplibregl.NavigationControl({ showCompass: false }), "bottom-right");
</script>
