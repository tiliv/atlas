---
---
<!doctype html>
<html lang="en">
<head>
  <title>{{ site.title | default: page.title }}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    worker-src blob:;
    connect-src 'self' https://unpkg.com https://demotiles.maplibre.org;
    img-src 'self' data: https://img.shields.io;
    script-src 'self' 'unsafe-inline' https://unpkg.com;
    style-src 'self' 'unsafe-inline' https://unpkg.com;
    font-src 'self' https://antibody.discoverywritten.com;
  ">
  <link rel="stylesheet" href="/site.css">
  <link rel="stylesheet" href="/content.css">
  <link rel="stylesheet" href="/map.css">
  <link rel="stylesheet" href="/projects.css">
  <script src="/preferences.js"></script>
  <script nonce="__init__">
    const preferences = PREFERENCES("{{ page.preferences }}"); // Scoped localStorage proxy
    const prefer = {{ site.preferences | jsonify }};  // Defaults, updates cache in this object
    const use = Object.fromEntries( // Map of setters, use these
      Object.keys(prefer).map((k) => {
        prefer[k] = preferences.retain(k, prefer[k], { force: false });  // init
        return [k, on => prefer[k] = preferences.use(k)(on)];  // call
      }));
  </script>
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet"/>
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
</head>
<body>
  <div id="title-stack" class="brand" role="banner" aria-label="Project title">
    <a href="/" style="display: flex; justify-content: center;">
    <h1 id="title-stroke" inert>{{ site.title }}</h1>
    <h1 id="title" aria-describe="Title:">{{ site.title }}</h1>
    </a>
  </div>
  <p id="replication">
    {{ site.civic_node }} Civic Node
    <br>{{ site.civic_tag }}
    <br><a href="{{ site.license_url }}" target="_blank">
      <img
        style="width: auto"
        src="{{ site.license_badge }}"
      />
    </a>
  </p>
  <div id="map" inert></div>
  <main class="styled">
    {{ content }}
  </main>
  <div id="footer">
    &nbsp;
  </div>
<script>
  const map = new maplibregl.Map({
    container:'map',
    ...({{ site.data.map.config | jsonify }}),
  });

  // add your data as sources + layers you control
  map.on('load', async () => {
    {% for kv in site.data.map.layers -%}
    {%- assign k = kv[0] -%}
    {%- assign layer = kv[1] -%}
    map.addSource('{{ k }}', { type:'geojson', data: '/map/layers/{{ layer.file }}.geo.json' });
    map.addLayer({ id:'{{ k }}-{{ layer.type }}', type:'{{ layer.type }}', source:'{{ k }}',
      paint: {{ layer.paint | jsonify }} });
    {%- endfor %}
  });

  const setVis = (id, on) => map.setLayoutProperty(id, 'visibility', on ? 'visible' : 'none');
  // setVis('parks-fill', false); // start hidden
</script>
</body>
</html>
